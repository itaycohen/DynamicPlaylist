function dpSongsListLogic(e,n){function t(){a(),o(),g(),B(),e.selectedGenres=D(),c(),A=!0}function s(){return e.rawSongsList}function r(){return e.songsIndexesList}function i(){return e.alreadyPlayedSongsIndexesListFull}function a(){var n=e.rawSongsList.length,t=Array.apply(null,{length:n}).map(Number.call,Number);e.songsIndexesList=t}function o(){for(var n=[],t=e.rawSongsList.length,s=0;s<t;s++){var r=e.rawSongsList[s],i=r.genreWeights,a=u(i,!0);n.push({index:s,avgDistance:a,genreWeightsDistance:{house:d(i.house),pop:d(i.pop),rb:d(i.rb),ir:d(i.ir),soul:d(i.soul)}})}e.genreWeightsDistancesList=n}function g(){e.alreadyPlayedSongsIndexesListSingleCycle=[],e.alreadyPlayedSongsIndexesListFull=[]}function u(e,n){var t=0,s=0;for(var r in e){var i=e[r];n&&(i=d(i)),t+=i,s++}return t/s}function d(e){return Math.abs(e-N)}function c(){l(!1)}function l(n,t){var s;s=angular.isUndefined(t)?0:e.songsIndexesList.indexOf(t);var r=e.songsIndexesList[s];e.currentPlayingSongIndex=r,e.songsIndexesList.splice(0,s+1),e.alreadyPlayedSongsIndexesListSingleCycle.push(r),e.alreadyPlayedSongsIndexesListFull.push(r),f(),n||e.$apply()}function f(){for(var n=e.genreWeightsDistancesList.slice(),t=[],s=[],r=0;r<n.length;r++){var i=n[r];i.avgDistance>F?s.push(i.index):t.push(i)}t.length===e.alreadyPlayedSongsIndexesListSingleCycle.length-(A?1:0)&&(e.alreadyPlayedSongsIndexesListSingleCycle=[],A=!1);var a=[];t.sort(function(e,n){var t;return S(e.index)&&!S(n.index)?1:!S(e.index)&&S(n.index)?-1:(t=e.avgDistance-n.avgDistance,0!==t?t:e.index-n.index)});for(var o=0;o<t.length;o++)a.push(t[o].index);var g=[];g=a.concat(s),e.songsIndexesList=g}function S(n){return e.alreadyPlayedSongsIndexesListSingleCycle.indexOf(n)!=-1}function L(){var n=e.currentPlayingSongIndex;return e.rawSongsList[n].id}function h(n,t){for(var s=e.genreWeightsDistancesList.length,r=0;r<s;r++){var i=e.genreWeightsDistancesList[r],a=x(r,n),o=Math.abs(a-t);i.genreWeightsDistance[n]=o;var g=u(i.genreWeightsDistance,!1);i.avgDistance=g,e.genreWeightsDistancesList[r]=i}f()}function x(e,n){return p(e)[n]}function p(e){return y(e).genreWeights}function y(n){return e.rawSongsList[n]}function v(){return e.currentPlayingSongIndex}function I(n){var t=e.rawSongsList[n].details;return t.artist+" - "+t.songName}function G(n){var t=e.rawSongsList[n].details;return t.songName}function P(n){var t=e.rawSongsList[n].details;return t.artist}function D(){return e.selectedGenres=H,e.selectedGenres}function W(){return angular.isUndefined(e.selectedGenres)?H:e.selectedGenres}function w(n){e.selectedGenres=n}function b(){return U}function m(){var n=e.selectedGenres;angular.isUndefined(n)&&(n=D());var t=U.filter(function(e){return n.indexOf(e)<0});return t}function B(){for(var e=W(),n=0;n<e.length;n++)selectedGenre=e[n],h(R(selectedGenre),3);for(var t=m(),s=0;s<t.length;s++)hiddenGenre=t[s],h(R(hiddenGenre),0)}function C(e){switch(e){case"house":return"House";case"pop":return"Pop";case"rb":return"R&B";case"ir":return"Indie-Rock";case"soul":return"Soul";default:return"Genre"}}function R(e){switch(e){case"House":return"house";case"Pop":return"pop";case"R&B":return"rb";case"Indie-Rock":return"ir";case"Soul":return"soul";default:return"Genre"}}var A,N=2.5,F=1.9,H=["House","Pop","R&B"],U=["House","Pop","R&B","Indie-Rock","Soul"],k={initCalcSongsList:t,getRawSongsList:s,getSongsIndexesList:r,getDefaultSelectedGenres:D,getSelectedGenres:W,setSelectedGenres:w,getHiddenGenres:m,geAllGenres:b,getAlreadyPlayedSongsIndexesListFull:i,popSongIndexFromListAndUpdate:l,getNextSongId:L,updateGenreWeightsDistancesList:h,updateGenreWeightsDistancesListByCurrentWidget:B,getCurrentPlayingSongIndex:v,getGenreLabel:C,updateSongsIndexesList:f,getSongArtistAndNameByIndex:I,getSongNameByIndex:G,getSongArtistByIndex:P};return k}angular.module("dpSongsListLogic",[]).factory("dpSongsListLogic",dpSongsListLogic),dpSongsListLogic.$inject=["$rootScope","dpSongsListUtils"];