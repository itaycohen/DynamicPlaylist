function dpSongsListLogic(e,n){function s(){a(),o(),g(),m(),e.selectedGenres=D(),l(),A=!0}function t(){return e.rawSongsList}function r(){return e.songsIndexesList}function i(){return e.alreadyPlayedSongsIndexesListFull}function a(){var n=e.rawSongsList.length,s=Array.apply(null,{length:n}).map(Number.call,Number);e.songsIndexesList=s}function o(){for(var n=[],s=e.rawSongsList.length,t=0;t<s;t++){var r=e.rawSongsList[t],i=r.genreWeights,a=d(i,!0);n.push({index:t,avgDistance:a,genreWeightsDistance:{house:u(i.house),pop:u(i.pop),rb:u(i.rb),ir:u(i.ir),soul:u(i.soul)}})}e.genreWeightsDistancesList=n}function g(){e.alreadyPlayedSongsIndexesListSingleCycle=[],e.alreadyPlayedSongsIndexesListFull=[]}function d(e,n){var s=0,t=0;for(var r in e){var i=e[r];n&&(i=u(i)),s+=i,t++}return s/t}function u(e){return Math.abs(e-N)}function l(){c(!1)}function c(n,s){var t,r;angular.isUndefined(s)?(t=0,r=e.songsIndexesList[0],e.songsIndexesList.shift(),e.alreadyPlayedSongsIndexesListSingleCycle.push(r),e.alreadyPlayedSongsIndexesListFull.push(r)):(t=e.songsIndexesList.indexOf(s),r=s),e.currentPlayingSongIndex=r;var i,a,o,g=e.songsIndexesList.splice(0,t+1);for(i=0,a=g.length;i<a;i++)o=g[i],e.alreadyPlayedSongsIndexesListSingleCycle.push(o),e.alreadyPlayedSongsIndexesListFull.push(o);S(),n||e.$apply()}function S(){for(var n=(e.alreadyPlayedSongsIndexesListSingleCycle[e.alreadyPlayedSongsIndexesListSingleCycle.length-1],e.genreWeightsDistancesList.slice()),s=[],t=[],r=0;r<n.length;r++){var i=n[r];i.avgDistance>F?t.push(i.index):s.push(i)}s.length===e.alreadyPlayedSongsIndexesListSingleCycle.length-(A?1:0)&&(e.alreadyPlayedSongsIndexesListSingleCycle=[],A=!1);var a=[];s.sort(function(e,n){var s;return f(e.index)&&!f(n.index)?1:!f(e.index)&&f(n.index)?-1:(s=e.avgDistance-n.avgDistance,0!==s?s:e.index-n.index)});for(var o=0;o<s.length;o++)a.push(s[o].index);var g=[];g=a.concat(t),e.songsIndexesList=g}function f(n){return e.alreadyPlayedSongsIndexesListSingleCycle.indexOf(n)!=-1}function L(){var n=e.currentPlayingSongIndex;return e.rawSongsList[n].id}function y(n,s){for(var t=e.genreWeightsDistancesList.length,r=0;r<t;r++){var i=e.genreWeightsDistancesList[r],a=h(r,n),o=Math.abs(a-s);i.genreWeightsDistance[n]=o;var g=d(i.genreWeightsDistance,!1);i.avgDistance=g,e.genreWeightsDistancesList[r]=i}S()}function h(e,n){return x(e)[n]}function x(e){return p(e).genreWeights}function p(n){return e.rawSongsList[n]}function I(){return e.currentPlayingSongIndex}function v(n){var s=e.rawSongsList[n].details;return s.artist+" - "+s.songName}function G(n){var s=e.rawSongsList[n].details;return s.songName}function P(n){var s=e.rawSongsList[n].details;return s.artist}function D(){return e.selectedGenres=H,e.selectedGenres}function W(){return angular.isUndefined(e.selectedGenres)?H:e.selectedGenres}function w(n){e.selectedGenres=n}function C(){return U}function b(){var n=e.selectedGenres;angular.isUndefined(n)&&(n=D());var s=U.filter(function(e){return n.indexOf(e)<0});return s}function m(){for(var e=W(),n=0;n<e.length;n++)selectedGenre=e[n],y(R(selectedGenre),3);for(var s=b(),t=0;t<s.length;t++)hiddenGenre=s[t],y(R(hiddenGenre),0)}function B(e){switch(e){case"house":return"House";case"pop":return"Pop";case"rb":return"R&B";case"ir":return"Indie-Rock";case"soul":return"Soul";default:return"Genre"}}function R(e){switch(e){case"House":return"house";case"Pop":return"pop";case"R&B":return"rb";case"Indie-Rock":return"ir";case"Soul":return"soul";default:return"Genre"}}var A,N=2.5,F=2,H=["House","Pop","R&B"],U=["House","Pop","R&B","Indie-Rock","Soul"],k={initCalcSongsList:s,getRawSongsList:t,getSongsIndexesList:r,getDefaultSelectedGenres:D,getSelectedGenres:W,setSelectedGenres:w,getHiddenGenres:b,geAllGenres:C,getAlreadyPlayedSongsIndexesListFull:i,popSongIndexFromListAndUpdate:c,getNextSongId:L,updateGenreWeightsDistancesList:y,updateGenreWeightsDistancesListByCurrentWidget:m,getCurrentPlayingSongIndex:I,getGenreLabel:B,updateSongsIndexesList:S,getSongArtistAndNameByIndex:v,getSongNameByIndex:G,getSongArtistByIndex:P};return k}angular.module("dpSongsListLogic",[]).factory("dpSongsListLogic",dpSongsListLogic),dpSongsListLogic.$inject=["$rootScope","dpSongsListUtils"];