function dpSongsListLogic(e,n){function t(){a(),g(),d(),B(),e.selectedGenres=C(),c(),F=!0}function s(){return e.rawSongsList}function i(){return e.songsIndexesList}function r(){return e.alreadyPlayedSongsIndexesListFull}function a(){var n=e.rawSongsList.length,t=Array.apply(null,{length:n}).map(Number.call,Number);e.songsIndexesList=t}function g(){for(var n=[],t=e.rawSongsList,s=t.length,i=0;i<s;i++){var r=t[i],a=r.g,g=o(a,!0),d=l(a);n.push({index:i,avgDistance:g,genreWeightsDistance:d})}e.genreWeightsDistancesList=n}function d(){e.alreadyPlayedSongsIndexesListSingleCycle=[],e.alreadyPlayedSongsIndexesListFull=[]}function o(e,n){var t=0,s=0;for(var i in e){var r=e[i];n&&(r=u(r)),t+=r,s++}return t/s}function l(e){for(var n=[],t=0;t<e.length;t++)n[t]=u(e[t]);return n}function u(e){return Math.abs(e-N)}function c(){f(!1)}function f(n,t){var s,i;angular.isUndefined(t)?(s=0,i=e.songsIndexesList[0],e.songsIndexesList.shift(),e.alreadyPlayedSongsIndexesListSingleCycle.push(i),e.alreadyPlayedSongsIndexesListFull.push(i)):(s=e.songsIndexesList.indexOf(t),i=t),e.currentPlayingSongIndex=i;var r,a,g,d=e.songsIndexesList.splice(0,s+1);for(r=0,a=d.length;r<a;r++)g=d[r],e.alreadyPlayedSongsIndexesListSingleCycle.push(g),e.alreadyPlayedSongsIndexesListFull.push(g);S(),n||e.$apply()}function S(){for(var n=(e.alreadyPlayedSongsIndexesListSingleCycle[e.alreadyPlayedSongsIndexesListSingleCycle.length-1],e.genreWeightsDistancesList.slice()),t=[],s=[],i=0;i<n.length;i++){var r=n[i];r.avgDistance>O?s.push(r.index):t.push(r)}t.length===e.alreadyPlayedSongsIndexesListSingleCycle.length-(F?1:0)&&(e.alreadyPlayedSongsIndexesListSingleCycle=[],F=!1);var a=[],g=new Date,d=g.getDay()*g.getMonth();t.sort(function(e,n){var t;if(L(e.index)&&!L(n.index))return 1;if(!L(e.index)&&L(n.index))return-1;if(t=e.avgDistance-n.avgDistance,0!==t)return t;var s=e.index%d,i=n.index%d;return s-i});for(var o=0;o<t.length;o++)a.push(t[o].index);var l=[];l=a.concat(s),e.songsIndexesList=l}function L(n){return e.alreadyPlayedSongsIndexesListSingleCycle.indexOf(n)!=-1}function y(){var n=e.currentPlayingSongIndex;return e.rawSongsList[n].id}function x(n,t){for(var s=e.genreWeightsDistancesList.length,i=0;i<s;i++){var r=e.genreWeightsDistancesList[i],a=h(i,n),g=Math.abs(a-t),d=b.indexOf(n);r.genreWeightsDistance[d]=g;var l=o(r.genreWeightsDistance,!1);r.avgDistance=l,e.genreWeightsDistancesList[i]=r}S()}function h(e,n){var t=v(e),s=b.indexOf(n),i=t[s];return i}function v(e){var n=p(e),t=n.g;return t}function p(n){return e.rawSongsList[n]}function I(){return e.currentPlayingSongIndex}function D(n){var t=e.rawSongsList[n];return t.a+" - "+t.s}function P(n){var t=e.rawSongsList[n];return t.s}function G(n){var t=e.rawSongsList[n];return t.a}function C(){return e.selectedGenres=U,e.selectedGenres}function W(){return angular.isUndefined(e.selectedGenres)?U:e.selectedGenres}function w(n){e.selectedGenres=n}function A(){return b}function m(){var n=e.selectedGenres;angular.isUndefined(n)&&(n=C());var t=b.filter(function(e){return n.indexOf(e)<0});return t}function B(){for(var e=W(),n=0;n<e.length;n++)selectedGenre=e[n],x(selectedGenre,3);for(var t=m(),s=0;s<t.length;s++)hiddenGenre=t[s],x(hiddenGenre,0)}var F,N=2.5,O=2,U=["Pop","R&B","Dance"],b=["Pop","Alternative","Dance","R&B","Latin","Soul","Hip-Hop"],H={initCalcSongsList:t,getRawSongsList:s,getSongsIndexesList:i,getDefaultSelectedGenres:C,getSelectedGenres:W,setSelectedGenres:w,getHiddenGenres:m,geAllGenres:A,getAlreadyPlayedSongsIndexesListFull:r,popSongIndexFromListAndUpdate:f,getNextSongId:y,updateGenreWeightsDistancesList:x,updateGenreWeightsDistancesListByCurrentWidget:B,getCurrentPlayingSongIndex:I,updateSongsIndexesList:S,getSongArtistAndNameByIndex:D,getSongNameByIndex:P,getSongArtistByIndex:G};return H}angular.module("dpSongsListLogic",[]).factory("dpSongsListLogic",dpSongsListLogic),dpSongsListLogic.$inject=["$rootScope","dpSongsListUtils"];