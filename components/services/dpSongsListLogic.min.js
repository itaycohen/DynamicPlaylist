function dpSongsListLogic(e,n){function r(){u(),t(),c(),l(),U(),f()}function t(){for(var n=D(),r=0,t=0;t<n.length;t++)n[t]>0&&r++;e.weightDistanceFactor=r>=4?1.5:4.9-r}function s(){if(e.userGenresMap=A,localStorage){var n=localStorage.getItem(B);if("undefined"!=typeof n&&"undefined"!=n&&null!==n){var r;try{if(r=JSON.parse(n),i(r))return void(e.userGenresMap=r);a()}catch(e){console.error("Error: "+e+" | Unable to parse local storage data. value: "+n)}}else a()}}function a(){e.userGenresMap=A;var n={};n=JSON.stringify(A);try{localStorage.setItem(B,n)}catch(e){console.error("Error: "+e+" | Unable to set item to local storage data")}}function i(e){return e.length===F.length}function o(){var n=JSON.stringify(e.userGenresMap);try{localStorage.setItem(B,n)}catch(e){console.error("Error: "+e+" | Unable to set item to local storage data")}}function g(){return e.songsIndexesList}function u(){var n=e.rawSongsList.length,r=Array.apply(null,{length:n}).map(Number.call,Number);e.songsIndexesList=r}function c(){for(var n=[],r=e.rawSongsList,t=r.length,s=0;s<t;s++){var a=r[s],i=a.g,o=d(i);n.push({index:s,avgDistance:o})}e.genreWeightsDistancesList=n}function l(){e.alreadyPlayedSongsIndexesListSingleCycle=[]}function d(e){for(var n=0,r=0,t=0,s=D(),a=0;a<s.length;a++){var i=s[a],o=e[a];i>0&&o>0&&(n=Math.abs(i-o),r+=n,t++)}return 0!==t?r/t:10}function f(){p(!1)}function p(n,r){var t,s;angular.isUndefined(r)?(t=0,s=e.songsIndexesList[0]):(t=e.songsIndexesList.indexOf(r),s=r),e.currentPlayingSongIndex=s;var a,i,o,g=e.songsIndexesList.splice(0,t+1);for(a=0,i=g.length;a<i;a++)o=g[a],e.alreadyPlayedSongsIndexesListSingleCycle.push(o);h(),n||e.$apply()}function h(){for(var n=(e.alreadyPlayedSongsIndexesListSingleCycle[e.alreadyPlayedSongsIndexesListSingleCycle.length-1],e.genreWeightsDistancesList.slice()),r=[],t=[],s=0;s<n.length;s++){var a=n[s];a.avgDistance>O()?t.push(a.index):r.push(a)}var i=r.length;if(i<=10){for(var o=[],g=0;g<n.length;g++){var u=n[g];o.push(u)}r=o}r.length<=e.alreadyPlayedSongsIndexesListSingleCycle.length&&(e.alreadyPlayedSongsIndexesListSingleCycle=[]);var c=[],l=new Date,d=l.getDay()*l.getMonth();r.sort(function(e,n){var r;if(S(e.index)&&!S(n.index))return 1;if(!S(e.index)&&S(n.index))return-1;if(r=e.avgDistance-n.avgDistance,0!==r)return r;var t=e.index%d,s=n.index%d;return t-s});for(var f=0;f<r.length;f++)c.push(r[f].index);var p=[];p=c.concat(t),e.songsIndexesList=p}function S(n){return e.alreadyPlayedSongsIndexesListSingleCycle.indexOf(n)!=-1}function y(){var n=e.currentPlayingSongIndex;return e.rawSongsList[n].id}function L(n,r){e.userGenresMap[F.indexOf(n)]=r,t();for(var s=e.genreWeightsDistancesList.length,a=0;a<s;a++){var i=e.genreWeightsDistancesList[a],o=v(a),g=d(o);i.avgDistance=g,e.genreWeightsDistancesList[a]=i}h()}function v(e){var n=x(e),r=n.g;return r}function x(n){return e.rawSongsList[n]}function G(){return e.currentPlayingSongIndex}function I(n){var r=e.rawSongsList[n];return r.s}function m(n){var r=e.rawSongsList[n];return r.a}function M(){return N(D())}function D(){return"undefined"!=typeof e.userGenresMap&&"undefined"!=e.userGenresMap&&null!==e.userGenresMap?e.userGenresMap:(console.error("$rootScope.userGenresMap was npt defined, $rootScope.userGenresMap: "+e.userGenresMap),e.userGenresMap=A,e.userGenresMap)}function N(e){for(var n=[],r=0;r<e.length;r++)currentGenreEntry=e[r],currentGenreEntry!==-1&&n.push(F[r]);return n}function P(n){for(var r=[],t=0;t<F.length;t++)if(currentGenreName=F[t],n.indexOf(currentGenreName)>-1){var s=e.userGenresMap[t];s===-1?r.push(b):r.push(s)}else r.push(-1);return r}function W(n){e.userGenresMap=P(n)}function C(){return F}function w(n){return e.userGenresMap[F.indexOf(n)]}function O(){return e.weightDistanceFactor}function U(){for(var n=e.userGenresMap,r=0;r<n.length;r++)currentGenreWeight=n[r],currentGenreName=F[r],currentGenreWeight!==-1?L(currentGenreName,currentGenreWeight):L(currentGenreName,-1)}var b=3,F=["Alternative","Chill Out","Country","Dance","Folk","Funk","Hip-Hop","Indie","Latin","Love","Metal","Pop","Punk","R&B","Rap","Reggae","Reggaeton","Rock","Soul","Trance"],A=[3,-1,-1,3,-1,-1,-1,3,-1,-1,-1,3,-1,-1,-1,-1,-1,-1,-1,-1],B="mm-data-genres",E={initCalcSongsList:r,initUserData:s,getSongsIndexesList:g,getUserGenresNames:M,setSelectedGenresByNames:W,getWeightOfGenre:w,geAllGenresNames:C,popSongIndexFromListAndUpdate:p,getNextSongId:y,updateGenreWeightsDistancesList:L,updateGenreWeightsDistancesListByCurrentWidget:U,getCurrentPlayingSongIndex:G,updateSongsIndexesList:h,getSongNameByIndex:I,getSongArtistByIndex:m,updateWeightDistanceFactor:t,storeUserGenresData:o};return E}angular.module("dpSongsListLogic",[]).factory("dpSongsListLogic",dpSongsListLogic),dpSongsListLogic.$inject=["$rootScope","dpSongsListUtils"];