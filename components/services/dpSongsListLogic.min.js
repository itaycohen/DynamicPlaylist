function dpSongsListLogic(e,n){function t(){a(),g(),o(),B(),e.selectedGenres=C(),c(),F=!0}function s(){return e.rawSongsList}function r(){return e.songsIndexesList}function i(){return e.alreadyPlayedSongsIndexesListFull}function a(){var n=e.rawSongsList.length,t=Array.apply(null,{length:n}).map(Number.call,Number);e.songsIndexesList=t}function g(){for(var n=[],t=e.rawSongsList,s=t.length,r=0;r<s;r++){var i=t[r],a=i.g,g=d(a,!0),o=l(a);n.push({index:r,avgDistance:g,genreWeightsDistance:o})}e.genreWeightsDistancesList=n}function o(){e.alreadyPlayedSongsIndexesListSingleCycle=[],e.alreadyPlayedSongsIndexesListFull=[]}function d(e,n){var t=0,s=0;for(var r in e){var i=e[r];n&&(i=u(i)),t+=i,s++}return t/s}function l(e){for(var n=[],t=0;t<e.length;t++)n[t]=u(e[t]);return n}function u(e){return Math.abs(e-N)}function c(){f(!1)}function f(n,t){var s,r;angular.isUndefined(t)?(s=0,r=e.songsIndexesList[0],e.songsIndexesList.shift(),e.alreadyPlayedSongsIndexesListSingleCycle.push(r),e.alreadyPlayedSongsIndexesListFull.push(r)):(s=e.songsIndexesList.indexOf(t),r=t),e.currentPlayingSongIndex=r;var i,a,g,o=e.songsIndexesList.splice(0,s+1);for(i=0,a=o.length;i<a;i++)g=o[i],e.alreadyPlayedSongsIndexesListSingleCycle.push(g),e.alreadyPlayedSongsIndexesListFull.push(g);S(),n||e.$apply()}function S(){for(var n=(e.alreadyPlayedSongsIndexesListSingleCycle[e.alreadyPlayedSongsIndexesListSingleCycle.length-1],e.genreWeightsDistancesList.slice()),t=[],s=[],r=0;r<n.length;r++){var i=n[r];i.avgDistance>O?s.push(i.index):t.push(i)}t.length===e.alreadyPlayedSongsIndexesListSingleCycle.length-(F?1:0)&&(e.alreadyPlayedSongsIndexesListSingleCycle=[],F=!1);var a=[],g=new Date,o=g.getDay()*g.getMonth();t.sort(function(e,n){var t;if(L(e.index)&&!L(n.index))return 1;if(!L(e.index)&&L(n.index))return-1;if(t=e.avgDistance-n.avgDistance,0!==t)return t;var s=e.index%o,r=n.index%o;return s-r});for(var d=0;d<t.length;d++)a.push(t[d].index);var l=[];l=a.concat(s),e.songsIndexesList=l}function L(n){return e.alreadyPlayedSongsIndexesListSingleCycle.indexOf(n)!=-1}function y(){console.log("getNextSongId");var n=e.currentPlayingSongIndex;return e.rawSongsList[n].id}function x(n,t){for(var s=e.genreWeightsDistancesList.length,r=0;r<s;r++){var i=e.genreWeightsDistancesList[r],a=h(r,n),g=Math.abs(a-t),o=b.indexOf(n);i.genreWeightsDistance[o]=g;var l=d(i.genreWeightsDistance,!1);i.avgDistance=l,e.genreWeightsDistancesList[r]=i}S()}function h(e,n){var t=v(e),s=b.indexOf(n),r=t[s];return r}function v(e){var n=I(e),t=n.g;return t}function I(n){return e.rawSongsList[n]}function p(){return e.currentPlayingSongIndex}function P(n){var t=e.rawSongsList[n];return t.a+" - "+t.s}function D(n){var t=e.rawSongsList[n];return t.s}function G(n){var t=e.rawSongsList[n];return t.a}function C(){return e.selectedGenres=U,e.selectedGenres}function W(){return angular.isUndefined(e.selectedGenres)?U:e.selectedGenres}function w(n){e.selectedGenres=n}function m(){return b}function A(){var n=e.selectedGenres;angular.isUndefined(n)&&(n=C());var t=b.filter(function(e){return n.indexOf(e)<0});return t}function B(){for(var e=W(),n=0;n<e.length;n++)selectedGenre=e[n],x(selectedGenre,3);for(var t=A(),s=0;s<t.length;s++)hiddenGenre=t[s],x(hiddenGenre,0)}var F,N=2.5,O=2,U=["House","Pop","R&B"],b=["House","Indie-Rock","Pop","R&B","Soul"],R={initCalcSongsList:t,getRawSongsList:s,getSongsIndexesList:r,getDefaultSelectedGenres:C,getSelectedGenres:W,setSelectedGenres:w,getHiddenGenres:A,geAllGenres:m,getAlreadyPlayedSongsIndexesListFull:i,popSongIndexFromListAndUpdate:f,getNextSongId:y,updateGenreWeightsDistancesList:x,updateGenreWeightsDistancesListByCurrentWidget:B,getCurrentPlayingSongIndex:p,updateSongsIndexesList:S,getSongArtistAndNameByIndex:P,getSongNameByIndex:D,getSongArtistByIndex:G};return R}angular.module("dpSongsListLogic",[]).factory("dpSongsListLogic",dpSongsListLogic),dpSongsListLogic.$inject=["$rootScope","dpSongsListUtils"];