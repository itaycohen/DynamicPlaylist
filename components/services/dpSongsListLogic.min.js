function dpSongsListLogic(e,n){function s(){a(),o(),g(),R(),e.selectedGenres=w(),c(),F=!0}function t(){return e.rawSongsList}function r(){return e.songsIndexesList}function i(){return e.alreadyPlayedSongsIndexesListFull}function a(){var n=e.rawSongsList.length,s=Array.apply(null,{length:n}).map(Number.call,Number);e.songsIndexesList=s}function o(){for(var n=[],s=e.rawSongsList,t=s.length,r=0;r<t;r++){var i=s[r],a=i.g,o=d(a,!0),g=u(a);n.push({index:r,avgDistance:o,genreWeightsDistance:g})}e.genreWeightsDistancesList=n}function g(){e.alreadyPlayedSongsIndexesListSingleCycle=[],e.alreadyPlayedSongsIndexesListFull=[]}function d(e,n){var s=0,t=0;for(var r in e){var i=e[r];n&&(i=l(i)),s+=i,t++}return s/t}function u(e){for(var n=[],s=0;s<e.length;s++)n[s]=l(e[s]);return n}function l(e){return Math.abs(e-H)}function c(){f(!1)}function f(n,s){var t,r;angular.isUndefined(s)?(t=0,r=e.songsIndexesList[0],e.songsIndexesList.shift(),e.alreadyPlayedSongsIndexesListSingleCycle.push(r),e.alreadyPlayedSongsIndexesListFull.push(r)):(t=e.songsIndexesList.indexOf(s),r=s),e.currentPlayingSongIndex=r;var i,a,o,g=e.songsIndexesList.splice(0,t+1);for(i=0,a=g.length;i<a;i++)o=g[i],e.alreadyPlayedSongsIndexesListSingleCycle.push(o),e.alreadyPlayedSongsIndexesListFull.push(o);S(),n||e.$apply()}function S(){for(var n=(e.alreadyPlayedSongsIndexesListSingleCycle[e.alreadyPlayedSongsIndexesListSingleCycle.length-1],e.genreWeightsDistancesList.slice()),s=[],t=[],r=0;r<n.length;r++){var i=n[r];i.avgDistance>N?t.push(i.index):s.push(i)}s.length===e.alreadyPlayedSongsIndexesListSingleCycle.length-(F?1:0)&&(e.alreadyPlayedSongsIndexesListSingleCycle=[],F=!1);var a=[];s.sort(function(e,n){var s;return L(e.index)&&!L(n.index)?1:!L(e.index)&&L(n.index)?-1:(s=e.avgDistance-n.avgDistance,0!==s?s:e.index-n.index)});for(var o=0;o<s.length;o++)a.push(s[o].index);var g=[];g=a.concat(t),e.songsIndexesList=g}function L(n){return e.alreadyPlayedSongsIndexesListSingleCycle.indexOf(n)!=-1}function y(){var n=e.currentPlayingSongIndex;return e.rawSongsList[n].id}function x(n,s){for(var t=e.genreWeightsDistancesList.length,r=0;r<t;r++){var i=e.genreWeightsDistancesList[r],a=h(r,n),o=Math.abs(a-s),g=k.indexOf(n);i.genreWeightsDistance[g]=o;var u=d(i.genreWeightsDistance,!1);i.avgDistance=u,e.genreWeightsDistancesList[r]=i}S()}function h(e,n){return p(e)[k.indexOf(n)]}function p(e){return I(e).g}function I(n){return e.rawSongsList[n]}function v(){return e.currentPlayingSongIndex}function G(n){var s=e.rawSongsList[n];return s.a+" - "+s.s}function P(n){var s=e.rawSongsList[n];return s.s}function D(n){var s=e.rawSongsList[n];return s.a}function w(){return e.selectedGenres=O,e.selectedGenres}function C(){return angular.isUndefined(e.selectedGenres)?O:e.selectedGenres}function W(n){e.selectedGenres=n}function b(){return U}function B(){var n=e.selectedGenres;angular.isUndefined(n)&&(n=w());var s=U.filter(function(e){return n.indexOf(e)<0});return s}function R(){for(var e=C(),n=0;n<e.length;n++)selectedGenre=e[n],x(A(selectedGenre),3);for(var s=B(),t=0;t<s.length;t++)hiddenGenre=s[t],x(A(hiddenGenre),0)}function m(e){switch(e){case"house":return"House";case"pop":return"Pop";case"rb":return"R&B";case"ir":return"Indie-Rock";case"soul":return"Soul";default:return"Genre"}}function A(e){switch(e){case"House":return"house";case"Pop":return"pop";case"R&B":return"rb";case"Indie-Rock":return"ir";case"Soul":return"soul";default:return"Genre"}}var F,H=2.5,N=2,O=["House","Pop","R&B"],U=["House","Indie-Rock","Pop","R&B","Soul"],k=["house","ir","pop","rb","soul"],$={initCalcSongsList:s,getRawSongsList:t,getSongsIndexesList:r,getDefaultSelectedGenres:w,getSelectedGenres:C,setSelectedGenres:W,getHiddenGenres:B,geAllGenres:b,getAlreadyPlayedSongsIndexesListFull:i,popSongIndexFromListAndUpdate:f,getNextSongId:y,updateGenreWeightsDistancesList:x,updateGenreWeightsDistancesListByCurrentWidget:R,getCurrentPlayingSongIndex:v,getGenreLabel:m,updateSongsIndexesList:S,getSongArtistAndNameByIndex:G,getSongNameByIndex:P,getSongArtistByIndex:D};return $}angular.module("dpSongsListLogic",[]).factory("dpSongsListLogic",dpSongsListLogic),dpSongsListLogic.$inject=["$rootScope","dpSongsListUtils"];