function dpSongsListLogic(e,n){function r(){g(),u(),c(),b(),p()}function t(){if(e.userGenresMap=J,localStorage){var n=localStorage.getItem(k);if("undefined"!=typeof n&&"undefined"!=n&&null!==n){var r;try{if(r=JSON.parse(n),a(r))return void(e.userGenresMap=r);s()}catch(e){console.error("Error: "+e+" | Unable to parse local storage data. value: "+n)}}else s()}}function s(){e.userGenresMap=J;var n={};n=JSON.stringify(J);try{localStorage.setItem(k,n)}catch(e){console.error("Error: "+e+" | Unable to set item to local storage data")}}function a(e){return e.length===$.length}function i(){var n=JSON.stringify(e.userGenresMap);try{localStorage.setItem(k,n)}catch(e){console.error("Error: "+e+" | Unable to set item to local storage data")}}function o(){return e.songsIndexesList}function g(){var n=e.rawSongsList.length,r=Array.apply(null,{length:n}).map(Number.call,Number);e.songsIndexesList=r}function u(){for(var n=[],r=e.rawSongsList,t=r.length,s=0;s<t;s++){var a=r[s],i=a.g,o=l(i,!0),g=d(i);n.push({index:s,avgDistance:o,genreWeightsDistance:g})}e.genreWeightsDistancesList=n}function c(){e.alreadyPlayedSongsIndexesListSingleCycle=[]}function l(e,n){var r=0,t=0;for(var s in e){var a=e[s];n&&(a=f(a)),r+=a,t++}return r/t}function d(e){for(var n=[],r=0;r<e.length;r++)n[r]=f(e[r]);return n}function f(e){return Math.abs(e-A)}function p(){S(!1)}function S(n,r){var t,s;angular.isUndefined(r)?(t=0,s=e.songsIndexesList[0]):(t=e.songsIndexesList.indexOf(r),s=r),e.currentPlayingSongIndex=s;var a,i,o,g=e.songsIndexesList.splice(0,t+1);for(a=0,i=g.length;a<i;a++)o=g[a],e.alreadyPlayedSongsIndexesListSingleCycle.push(o);h(),n||e.$apply()}function h(){for(var n=(e.alreadyPlayedSongsIndexesListSingleCycle[e.alreadyPlayedSongsIndexesListSingleCycle.length-1],e.genreWeightsDistancesList.slice()),r=[],t=[],s=0;s<n.length;s++){var a=n[s];a.avgDistance>B?t.push(a.index):r.push(a)}r.length<=e.alreadyPlayedSongsIndexesListSingleCycle.length&&(e.alreadyPlayedSongsIndexesListSingleCycle=[]);var i=[],o=new Date,g=o.getDay()*o.getMonth();r.sort(function(e,n){var r;if(y(e.index)&&!y(n.index))return 1;if(!y(e.index)&&y(n.index))return-1;if(r=e.avgDistance-n.avgDistance,0!==r)return r;var t=e.index%g,s=n.index%g;return t-s});for(var u=0;u<r.length;u++)i.push(r[u].index);var c=[];c=i.concat(t),e.songsIndexesList=c}function y(n){return e.alreadyPlayedSongsIndexesListSingleCycle.indexOf(n)!=-1}function L(){var n=e.currentPlayingSongIndex;return e.rawSongsList[n].id}function v(n,r){for(var t=e.genreWeightsDistancesList.length,s=0;s<t;s++){var a=e.genreWeightsDistancesList[s],i=x(s,n),o=Math.abs(i-r),g=$.indexOf(n);a.genreWeightsDistance[g]=o;var u=l(a.genreWeightsDistance,!1);a.avgDistance=u,e.genreWeightsDistancesList[s]=a}h(),e.userGenresMap[$.indexOf(n)]=r}function x(e,n){var r=G(e),t=$.indexOf(n),s=r[t];return s}function G(e){var n=I(e),r=n.g;return r}function I(n){return e.rawSongsList[n]}function M(){return e.currentPlayingSongIndex}function m(n){var r=e.rawSongsList[n];return r.s}function D(n){var r=e.rawSongsList[n];return r.a}function N(){return C(W())}function W(){return"undefined"!=typeof e.userGenresMap&&"undefined"!=e.userGenresMap&&null!==e.userGenresMap?e.userGenresMap:(console.error("$rootScope.userGenresMap was npt defined, $rootScope.userGenresMap: "+e.userGenresMap),e.userGenresMap=J,e.userGenresMap)}function C(e){for(var n=[],r=0;r<e.length;r++)currentGenreEntry=e[r],currentGenreEntry!==-1&&n.push($[r]);return n}function O(n){for(var r=[],t=0;t<$.length;t++)if(currentGenreName=$[t],n.indexOf(currentGenreName)>-1){var s=e.userGenresMap[t];s===-1?r.push(E):r.push(s)}else r.push(-1);return r}function P(n){e.userGenresMap=O(n)}function U(){return $}function w(n){return e.userGenresMap[$.indexOf(n)]}function b(){for(var n=e.userGenresMap,r=0;r<n.length;r++)currentGenreWeight=n[r],currentGenreName=$[r],currentGenreWeight!==-1?v(currentGenreName,currentGenreWeight):v(currentGenreName,-1)}var A=2.5,B=1.6,E=3,$=["Alternative","Chill Out","Country","Dance","Folk","Hip-Hop","Indie","Latin","Love","Metal","Pop","R&B","Rock","Soul"],J=[3,-1,-1,3,-1,-1,-1,-1,-1,-1,3,-1,-1,-1],k="mm-data-genres",F={initCalcSongsList:r,initUserData:t,getSongsIndexesList:o,getUserGenresNames:N,setSelectedGenresByNames:P,getWeightOfGenre:w,geAllGenresNames:U,popSongIndexFromListAndUpdate:S,getNextSongId:L,updateGenreWeightsDistancesList:v,updateGenreWeightsDistancesListByCurrentWidget:b,getCurrentPlayingSongIndex:M,updateSongsIndexesList:h,getSongNameByIndex:m,getSongArtistByIndex:D,storeUserGenresData:i};return F}angular.module("dpSongsListLogic",[]).factory("dpSongsListLogic",dpSongsListLogic),dpSongsListLogic.$inject=["$rootScope","dpSongsListUtils"];