function dpSongsListLogic(e,n){function t(){i(),a(),g(),A(),e.selectedGenres=P(),l()}function s(){return e.rawSongsList}function r(){return e.songsIndexesList}function i(){var n=e.rawSongsList.length,t=Array.apply(null,{length:n}).map(Number.call,Number);e.songsIndexesList=t}function a(){for(var n=[],t=e.rawSongsList,s=t.length,r=0;r<s;r++){var i=t[r],a=i.g,g=o(a,!0),c=d(a);n.push({index:r,avgDistance:g,genreWeightsDistance:c})}e.genreWeightsDistancesList=n}function g(){e.alreadyPlayedSongsIndexesListSingleCycle=[]}function o(e,n){var t=0,s=0;for(var r in e){var i=e[r];n&&(i=c(i)),t+=i,s++}return t/s}function d(e){for(var n=[],t=0;t<e.length;t++)n[t]=c(e[t]);return n}function c(e){return Math.abs(e-B)}function l(){u(!1)}function u(n,t){var s,r;angular.isUndefined(t)?(s=0,r=e.songsIndexesList[0]):(s=e.songsIndexesList.indexOf(t),r=t),e.currentPlayingSongIndex=r;var i,a,g,o=e.songsIndexesList.splice(0,s+1);for(i=0,a=o.length;i<a;i++)g=o[i],e.alreadyPlayedSongsIndexesListSingleCycle.push(g);f(),n||e.$apply()}function f(){for(var n=(e.alreadyPlayedSongsIndexesListSingleCycle[e.alreadyPlayedSongsIndexesListSingleCycle.length-1],e.genreWeightsDistancesList.slice()),t=[],s=[],r=0;r<n.length;r++){var i=n[r];i.avgDistance>N?s.push(i.index):t.push(i)}t.length<=e.alreadyPlayedSongsIndexesListSingleCycle.length&&(e.alreadyPlayedSongsIndexesListSingleCycle=[]);var a=[],g=new Date,o=g.getDay()*g.getMonth();t.sort(function(e,n){var t;if(S(e.index)&&!S(n.index))return 1;if(!S(e.index)&&S(n.index))return-1;if(t=e.avgDistance-n.avgDistance,0!==t)return t;var s=e.index%o,r=n.index%o;return s-r});for(var d=0;d<t.length;d++)a.push(t[d].index);var c=[];c=a.concat(s),e.songsIndexesList=c}function S(n){return e.alreadyPlayedSongsIndexesListSingleCycle.indexOf(n)!=-1}function L(){var n=e.currentPlayingSongIndex;return e.rawSongsList[n].id}function x(n,t){for(var s=e.genreWeightsDistancesList.length,r=0;r<s;r++){var i=e.genreWeightsDistancesList[r],a=v(r,n),g=Math.abs(a-t),d=U.indexOf(n);i.genreWeightsDistance[d]=g;var c=o(i.genreWeightsDistance,!1);i.avgDistance=c,e.genreWeightsDistancesList[r]=i}f()}function v(e,n){var t=y(e),s=U.indexOf(n),r=t[s];return r}function y(e){var n=h(e),t=n.g;return t}function h(n){return e.rawSongsList[n]}function p(){return e.currentPlayingSongIndex}function I(n){var t=e.rawSongsList[n];return t.a+" - "+t.s}function D(n){var t=e.rawSongsList[n];return t.s}function G(n){var t=e.rawSongsList[n];return t.a}function P(){return e.selectedGenres=O,e.selectedGenres}function W(){return angular.isUndefined(e.selectedGenres)?O:e.selectedGenres}function w(n){e.selectedGenres=n}function C(){return U}function m(){var n=e.selectedGenres;angular.isUndefined(n)&&(n=P());var t=U.filter(function(e){return n.indexOf(e)<0});return t}function A(){for(var e=W(),n=0;n<e.length;n++)selectedGenre=e[n],x(selectedGenre,3);for(var t=m(),s=0;s<t.length;s++)hiddenGenre=t[s],x(hiddenGenre,0)}var B=2.5,N=1.8,O=["Pop","R&B","Dance"],U=["Pop","Alternative","Dance","R&B","Latin","Soul","Hip-Hop"],b={initCalcSongsList:t,getRawSongsList:s,getSongsIndexesList:r,getDefaultSelectedGenres:P,getSelectedGenres:W,setSelectedGenres:w,getHiddenGenres:m,geAllGenres:C,popSongIndexFromListAndUpdate:u,getNextSongId:L,updateGenreWeightsDistancesList:x,updateGenreWeightsDistancesListByCurrentWidget:A,getCurrentPlayingSongIndex:p,updateSongsIndexesList:f,getSongArtistAndNameByIndex:I,getSongNameByIndex:D,getSongArtistByIndex:G};return b}angular.module("dpSongsListLogic",[]).factory("dpSongsListLogic",dpSongsListLogic),dpSongsListLogic.$inject=["$rootScope","dpSongsListUtils"];