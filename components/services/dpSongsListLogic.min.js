function dpSongsListLogic(e,n){function r(){o(),g(),u(),U(),f()}function t(){if(e.userGenresMap=E,localStorage){var n=localStorage.getItem(J);if("undefined"==typeof n||"undefined"==n||null===n){e.userGenresMap=E;var r={};return r=JSON.stringify(E),void localStorage.setItem(J,r)}var t;try{if(t=JSON.parse(n),s(t))return void(e.userGenresMap=t)}catch(e){console.error("Error: "+e+" | Unable to parse local storage data. value: "+n)}}}function s(e){return e.length===$.length}function i(){var n=JSON.stringify(e.userGenresMap);localStorage.setItem(J,n)}function a(){return e.songsIndexesList}function o(){var n=e.rawSongsList.length,r=Array.apply(null,{length:n}).map(Number.call,Number);e.songsIndexesList=r}function g(){for(var n=[],r=e.rawSongsList,t=r.length,s=0;s<t;s++){var i=r[s],a=i.g,o=c(a,!0),g=l(a);n.push({index:s,avgDistance:o,genreWeightsDistance:g})}e.genreWeightsDistancesList=n}function u(){e.alreadyPlayedSongsIndexesListSingleCycle=[]}function c(e,n){var r=0,t=0;for(var s in e){var i=e[s];n&&(i=d(i)),r+=i,t++}return r/t}function l(e){for(var n=[],r=0;r<e.length;r++)n[r]=d(e[r]);return n}function d(e){return Math.abs(e-b)}function f(){p(!1)}function p(n,r){var t,s;angular.isUndefined(r)?(t=0,s=e.songsIndexesList[0]):(t=e.songsIndexesList.indexOf(r),s=r),e.currentPlayingSongIndex=s;var i,a,o,g=e.songsIndexesList.splice(0,t+1);for(i=0,a=g.length;i<a;i++)o=g[i],e.alreadyPlayedSongsIndexesListSingleCycle.push(o);S(),n||e.$apply()}function S(){for(var n=(e.alreadyPlayedSongsIndexesListSingleCycle[e.alreadyPlayedSongsIndexesListSingleCycle.length-1],e.genreWeightsDistancesList.slice()),r=[],t=[],s=0;s<n.length;s++){var i=n[s];i.avgDistance>A?t.push(i.index):r.push(i)}r.length<=e.alreadyPlayedSongsIndexesListSingleCycle.length&&(e.alreadyPlayedSongsIndexesListSingleCycle=[]);var a=[],o=new Date,g=o.getDay()*o.getMonth();r.sort(function(e,n){var r;if(h(e.index)&&!h(n.index))return 1;if(!h(e.index)&&h(n.index))return-1;if(r=e.avgDistance-n.avgDistance,0!==r)return r;var t=e.index%g,s=n.index%g;return t-s});for(var u=0;u<r.length;u++)a.push(r[u].index);var c=[];c=a.concat(t),e.songsIndexesList=c}function h(n){return e.alreadyPlayedSongsIndexesListSingleCycle.indexOf(n)!=-1}function v(){var n=e.currentPlayingSongIndex;return e.rawSongsList[n].id}function L(n,r){for(var t=e.genreWeightsDistancesList.length,s=0;s<t;s++){var i=e.genreWeightsDistancesList[s],a=y(s,n),o=Math.abs(a-r),g=$.indexOf(n);i.genreWeightsDistance[g]=o;var u=c(i.genreWeightsDistance,!1);i.avgDistance=u,e.genreWeightsDistancesList[s]=i}S(),e.userGenresMap[$.indexOf(n)]=r}function y(e,n){var r=x(e),t=$.indexOf(n),s=r[t];return s}function x(e){var n=G(e),r=n.g;return r}function G(n){return e.rawSongsList[n]}function I(){return e.currentPlayingSongIndex}function M(n){var r=e.rawSongsList[n];return r.s}function D(n){var r=e.rawSongsList[n];return r.a}function m(){return W(N())}function N(){return"undefined"!=typeof e.userGenresMap&&"undefined"!=e.userGenresMap&&null!==e.userGenresMap?e.userGenresMap:(console.error("$rootScope.userGenresMap was npt defined, $rootScope.userGenresMap: "+e.userGenresMap),e.userGenresMap=E,e.userGenresMap)}function W(e){for(var n=[],r=0;r<e.length;r++)currentGenreEntry=e[r],currentGenreEntry!==-1&&n.push($[r]);return n}function P(n){for(var r=[],t=0;t<$.length;t++)if(currentGenreName=$[t],n.indexOf(currentGenreName)>-1){var s=e.userGenresMap[t];s===-1?r.push(B):r.push(s)}else r.push(-1);return r}function O(n){e.userGenresMap=P(n)}function C(){return $}function w(n){return e.userGenresMap[$.indexOf(n)]}function U(){for(var n=e.userGenresMap,r=0;r<n.length;r++)currentGenreWeight=n[r],currentGenreName=$[r],currentGenreWeight!==-1?L(currentGenreName,currentGenreWeight):L(currentGenreName,-1)}var b=2.5,A=1.8,B=3,$=["Pop","Alternative","Dance","R&B","Latin","Soul","Hip-Hop"],E=[3,-1,3,3,-1,-1,-1],J="mm-data-genres",H={initCalcSongsList:r,initUserData:t,getSongsIndexesList:a,getUserGenresNames:m,setSelectedGenresByNames:O,getWeightOfGenre:w,geAllGenresNames:C,popSongIndexFromListAndUpdate:p,getNextSongId:v,updateGenreWeightsDistancesList:L,updateGenreWeightsDistancesListByCurrentWidget:U,getCurrentPlayingSongIndex:I,updateSongsIndexesList:S,getSongNameByIndex:M,getSongArtistByIndex:D,storeUserGenresData:i};return H}angular.module("dpSongsListLogic",[]).factory("dpSongsListLogic",dpSongsListLogic),dpSongsListLogic.$inject=["$rootScope","dpSongsListUtils"];